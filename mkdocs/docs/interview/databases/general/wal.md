# Журнал предзаписи

При сбое вся информация из оперативки - теряется. Чтобы сервер мог стартовать после сбоя, необходимо восстановить согласованность данных.

Для этого, как вариант, можно все время поддерживать данные на диске в согласованном виде, но это очень дорого.

В большинстве СУБД используется другой подход: в процессе работы часть актуальных данных хранится только в оперативке и записывается на диск отложенно. ПРи этом, каждое действие в оперативной памяти журналируется: создается и сохраняется на диске журнальная запись, содержащая минимальную информацию, достаточную для повторения того же действия в случае необходимости

Журнальная запись об изменении страницы в обязательном порядке попадает на диск перед тем, как туда попадет измененная страница. Отсюда и название: журнал предзаписи (write-ahead log).

На диске журнал хранится в каталоге PGDATA/pg_wal в виде файлов 16MB сегментов

Для восстановления согласованности после сбоя необходимо последовательно читать журнал и применять к страницам те записи, которые относятся к пропавшим изменениям. Однако остается непонятным, с какой именно записи следует начинать восстановление.

Выполнением контрольной точки занимается специальный фоновый процесс checkpointer
