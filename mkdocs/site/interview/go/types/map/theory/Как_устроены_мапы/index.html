<!doctype html><html class=no-js lang=ru><meta charset=utf-8><meta content="width=device-width,initial-scale=1" name=viewport><link href=../../../../liveCoding/complex/ rel=prev><link href=../../problems/findBugs/findBugs/ rel=next><link href=../../../../../../assets/images/favicon.png rel=icon><meta content="mkdocs-1.5.3, mkdocs-material-9.5.3" name=generator><title>Теория - Документация</title><link href=../../../../../../assets/stylesheets/main.50c56a3b.min.css rel=stylesheet><link href=../../../../../../assets/stylesheets/palette.06af60db.min.css rel=stylesheet><style>:root{--md-annotation-icon:url('data:image/svg+xml;charset=utf-8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M22 12a10 10 0 0 1-10 10A10 10 0 0 1 2 12 10 10 0 0 1 12 2a10 10 0 0 1 10 10m-12 6 6-6-6-6-1.4 1.4 4.6 4.6-4.6 4.6L10 18Z"/></svg>');}</style><link crossorigin href=https://fonts.gstatic.com rel=preconnect><link href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback" rel=stylesheet><style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style><link href=../../../../../../stylesheets/extra.css rel=stylesheet><script>__md_scope=new URL("../../../../../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script><body data-md-color-accent=purple data-md-color-primary=deep-purple data-md-color-scheme=slate dir=ltr><input autocomplete=off class=md-toggle data-md-toggle=drawer id=__drawer type=checkbox><input autocomplete=off class=md-toggle data-md-toggle=search id=__search type=checkbox><label class=md-overlay for=__drawer></label><div data-md-component=skip><a class=md-skip href=#_1> Перейти к содержанию </a></div><div data-md-component=announce></div><header class="md-header md-header--shadow md-header--lifted" data-md-component=header><nav aria-label="Верхний колонтитул" class="md-header__inner md-grid"><a class="md-header__button md-logo" aria-label=Документация data-md-component=logo href=../../../../../.. title=Документация> <svg viewbox="0 0 24 24" xmlns=http://www.w3.org/2000/svg><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg> </a><label class="md-header__button md-icon" for=__drawer><svg viewbox="0 0 24 24" xmlns=http://www.w3.org/2000/svg><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg></label><div class=md-header__title data-md-component=header-title><div class=md-header__ellipsis><div class=md-header__topic><span class=md-ellipsis> Документация </span></div><div class=md-header__topic data-md-component=header-topic><span class=md-ellipsis> Теория </span></div></div></div><form class=md-header__option data-md-component=palette><input aria-label="Switch to dark mode" class=md-option data-md-color-accent=purple data-md-color-media data-md-color-primary=deep-purple data-md-color-scheme=slate id=__palette_0 name=__palette type=radio><label class="md-header__button md-icon" title="Switch to dark mode" for=__palette_1 hidden><svg viewbox="0 0 24 24" xmlns=http://www.w3.org/2000/svg><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12c0-2.42-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12 20 8.69Z"/></svg></label><input aria-label="Switch to light mode" class=md-option data-md-color-accent=purple data-md-color-media data-md-color-primary=deep-purple data-md-color-scheme=default id=__palette_1 name=__palette type=radio><label class="md-header__button md-icon" title="Switch to light mode" for=__palette_0 hidden><svg viewbox="0 0 24 24" xmlns=http://www.w3.org/2000/svg><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12c0-2.42-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12 20 8.69Z"/></svg></label></form><script>var media,input,key,value,palette=__md_get("__palette");if(palette&&palette.color){"(prefers-color-scheme)"===palette.color.media&&(media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']"),palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent"));for([key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script><label class="md-header__button md-icon" for=__search><svg viewbox="0 0 24 24" xmlns=http://www.w3.org/2000/svg><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg></label><div class=md-search data-md-component=search role=dialog><label class=md-search__overlay for=__search></label><div class=md-search__inner role=search><form class=md-search__form name=search><input aria-label=Поиск autocapitalize=off autocomplete=off autocorrect=off class=md-search__input data-md-component=search-query name=query placeholder=Поиск required spellcheck=false type=text><label class="md-search__icon md-icon" for=__search><svg viewbox="0 0 24 24" xmlns=http://www.w3.org/2000/svg><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg> <svg viewbox="0 0 24 24" xmlns=http://www.w3.org/2000/svg><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg></label><nav aria-label=Поиск class=md-search__options><a class="md-search__icon md-icon" aria-label=Поделиться data-clipboard data-clipboard-text data-md-component=search-share href=javascript:void(0) tabindex=-1 title=Поделиться> <svg viewbox="0 0 24 24" xmlns=http://www.w3.org/2000/svg><path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7 0-.24-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9a3 3 0 0 0-3 3 3 3 0 0 0 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.15c-.05.21-.08.43-.08.66 0 1.61 1.31 2.91 2.92 2.91 1.61 0 2.92-1.3 2.92-2.91A2.92 2.92 0 0 0 18 16.08Z"/></svg> </a><button class="md-search__icon md-icon" aria-label=Очистить tabindex=-1 title=Очистить type=reset><svg viewbox="0 0 24 24" xmlns=http://www.w3.org/2000/svg><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg></button></nav><div class=md-search__suggest data-md-component=search-suggest></div></form><div class=md-search__output><div class=md-search__scrollwrap data-md-scrollfix><div class=md-search-result data-md-component=search-result><div class=md-search-result__meta>Инициализация поиска</div><ol class=md-search-result__list role=presentation></ol></div></div></div></div></div><div class=md-header__source><a title="Перейти к репозиторию" class=md-source data-md-component=source href=https://github.com/Slava02/Docs> <div class="md-source__icon md-icon"><svg viewbox="0 0 512 512" xmlns=http://www.w3.org/2000/svg><path d="m503.5 204.6-.7-1.8-69.7-181.78c-1.4-3.57-3.9-6.59-7.2-8.64-2.4-1.55-5.1-2.515-8-2.81-2.9-.295-5.7.083-8.4 1.11-2.7 1.02-5.1 2.66-7.1 4.78-1.9 2.12-3.3 4.67-4.1 7.44l-47 144H160.8l-47.1-144c-.8-2.77-2.2-5.31-4.1-7.43-2-2.12-4.4-3.75-7.1-4.77a18.1 18.1 0 0 0-8.38-1.113 18.4 18.4 0 0 0-8.04 2.793 18.09 18.09 0 0 0-7.16 8.64L9.267 202.8l-.724 1.8a129.57 129.57 0 0 0-3.52 82c7.747 26.9 24.047 50.7 46.447 67.6l.27.2.59.4 105.97 79.5 52.6 39.7 32 24.2c3.7 1.9 8.3 4.3 13 4.3 4.7 0 9.3-2.4 13-4.3l32-24.2 52.6-39.7 106.7-79.9.3-.3c22.4-16.9 38.7-40.6 45.6-67.5 8.6-27 7.4-55.8-2.6-82z"/></svg></div> <div class=md-source__repository>Docs</div> </a></div></nav><nav aria-label=Вкладки class=md-tabs data-md-component=tabs><div class=md-grid><ul class=md-tabs__list><li class=md-tabs__item><a class=md-tabs__link href=../../../../../..> Обзор </a><li class="md-tabs__item md-tabs__item--active"><a class=md-tabs__link href=../../../../concurrency/theory/channels/channels/> Собесы </a></ul></div></nav></header><div class=md-container data-md-component=container><main class=md-main data-md-component=main><div class="md-main__inner md-grid"><div class="md-sidebar md-sidebar--primary" data-md-component=sidebar data-md-type=navigation><div class=md-sidebar__scrollwrap><div class=md-sidebar__inner><nav class="md-nav md-nav--primary md-nav--lifted" aria-label=Навигация data-md-level=0><label class=md-nav__title for=__drawer><a class="md-nav__button md-logo" aria-label=Документация data-md-component=logo href=../../../../../.. title=Документация> <svg viewbox="0 0 24 24" xmlns=http://www.w3.org/2000/svg><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg> </a> Документация</label><div class=md-nav__source><a title="Перейти к репозиторию" class=md-source data-md-component=source href=https://github.com/Slava02/Docs> <div class="md-source__icon md-icon"><svg viewbox="0 0 512 512" xmlns=http://www.w3.org/2000/svg><path d="m503.5 204.6-.7-1.8-69.7-181.78c-1.4-3.57-3.9-6.59-7.2-8.64-2.4-1.55-5.1-2.515-8-2.81-2.9-.295-5.7.083-8.4 1.11-2.7 1.02-5.1 2.66-7.1 4.78-1.9 2.12-3.3 4.67-4.1 7.44l-47 144H160.8l-47.1-144c-.8-2.77-2.2-5.31-4.1-7.43-2-2.12-4.4-3.75-7.1-4.77a18.1 18.1 0 0 0-8.38-1.113 18.4 18.4 0 0 0-8.04 2.793 18.09 18.09 0 0 0-7.16 8.64L9.267 202.8l-.724 1.8a129.57 129.57 0 0 0-3.52 82c7.747 26.9 24.047 50.7 46.447 67.6l.27.2.59.4 105.97 79.5 52.6 39.7 32 24.2c3.7 1.9 8.3 4.3 13 4.3 4.7 0 9.3-2.4 13-4.3l32-24.2 52.6-39.7 106.7-79.9.3-.3c22.4-16.9 38.7-40.6 45.6-67.5 8.6-27 7.4-55.8-2.6-82z"/></svg></div> <div class=md-source__repository>Docs</div> </a></div><ul class=md-nav__list data-md-scrollfix><li class="md-nav__item md-nav__item--section md-nav__item--nested"><input class="md-nav__toggle md-toggle" id=__nav_1 type=checkbox> <div class="md-nav__link md-nav__container"><a class=md-nav__link href=../../../../../..> <span class=md-ellipsis> Обзор </span> </a></div> <nav aria-expanded=false aria-labelledby=__nav_1_label class=md-nav data-md-level=1><label class=md-nav__title for=__nav_1><span class="md-nav__icon md-icon"></span> Обзор</label><ul class=md-nav__list data-md-scrollfix></ul></nav><li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested"><input class="md-nav__toggle md-toggle" checked id=__nav_2 type=checkbox> <label class=md-nav__link for=__nav_2 id=__nav_2_label><span class=md-ellipsis> Собесы </span> <span class="md-nav__icon md-icon"></span></label> <nav aria-expanded=true aria-labelledby=__nav_2_label class=md-nav data-md-level=1><label class=md-nav__title for=__nav_2><span class="md-nav__icon md-icon"></span> Собесы</label><ul class=md-nav__list data-md-scrollfix><li class="md-nav__item md-nav__item--active md-nav__item--nested"><input class="md-nav__toggle md-toggle" checked id=__nav_2_1 type=checkbox> <label class=md-nav__link for=__nav_2_1 id=__nav_2_1_label tabindex=0><span class=md-ellipsis> GO </span> <span class="md-nav__icon md-icon"></span></label> <nav aria-expanded=true aria-labelledby=__nav_2_1_label class=md-nav data-md-level=2><label class=md-nav__title for=__nav_2_1><span class="md-nav__icon md-icon"></span> GO</label><ul class=md-nav__list data-md-scrollfix><li class="md-nav__item md-nav__item--pruned md-nav__item--nested"><a class=md-nav__link href=../../../../concurrency/theory/channels/channels/> <span class=md-ellipsis> Concurrency </span> <span class="md-nav__icon md-icon"></span> </a><li class=md-nav__item><a class=md-nav__link href=../../../../liveCoding/complex/> <span class=md-ellipsis> Live Coding </span> </a><li class="md-nav__item md-nav__item--active md-nav__item--nested"><input class="md-nav__toggle md-toggle" checked id=__nav_2_1_3 type=checkbox> <label class=md-nav__link for=__nav_2_1_3 id=__nav_2_1_3_label tabindex=0><span class=md-ellipsis> Базовые типы </span> <span class="md-nav__icon md-icon"></span></label> <nav aria-expanded=true aria-labelledby=__nav_2_1_3_label class=md-nav data-md-level=3><label class=md-nav__title for=__nav_2_1_3><span class="md-nav__icon md-icon"></span> Базовые типы</label><ul class=md-nav__list data-md-scrollfix><li class="md-nav__item md-nav__item--active md-nav__item--nested"><input class="md-nav__toggle md-toggle" checked id=__nav_2_1_3_1 type=checkbox> <label class=md-nav__link for=__nav_2_1_3_1 id=__nav_2_1_3_1_label tabindex=0><span class=md-ellipsis> Map </span> <span class="md-nav__icon md-icon"></span></label> <nav aria-expanded=true aria-labelledby=__nav_2_1_3_1_label class=md-nav data-md-level=4><label class=md-nav__title for=__nav_2_1_3_1><span class="md-nav__icon md-icon"></span> Map</label><ul class=md-nav__list data-md-scrollfix><li class="md-nav__item md-nav__item--active"><input class="md-nav__toggle md-toggle" id=__toc type=checkbox> <label class="md-nav__link md-nav__link--active" for=__toc><span class=md-ellipsis> Теория </span> <span class="md-nav__icon md-icon"></span></label> <a class="md-nav__link md-nav__link--active" href=./> <span class=md-ellipsis> Теория </span> </a> <nav class="md-nav md-nav--secondary" aria-label=Содержание><label class=md-nav__title for=__toc><span class="md-nav__icon md-icon"></span> Содержание</label><ul class=md-nav__list data-md-component=toc data-md-scrollfix><li class=md-nav__item><a class=md-nav__link href=#_1> <span class=md-ellipsis> Требования к реализации </span> </a><li class=md-nav__item><a class=md-nav__link href=#_2> <span class=md-ellipsis> Реализация </span> </a> <nav aria-label=Реализация class=md-nav><ul class=md-nav__list><li class=md-nav__item><a class=md-nav__link href=#1> <span class=md-ellipsis> Версия 1 </span> </a><li class=md-nav__item><a class=md-nav__link href=#2> <span class=md-ellipsis> Версия 2 </span> </a></ul></nav><li class=md-nav__item><a class=md-nav__link href=#_3> <span class=md-ellipsis> Рост мапы </span> </a><li class=md-nav__item><a class=md-nav__link href=#_4> <span class=md-ellipsis> Вопросы для самопроверки </span> </a></ul></nav><li class="md-nav__item md-nav__item--pruned md-nav__item--nested"><a class=md-nav__link href=../../problems/findBugs/findBugs/> <span class=md-ellipsis> Задачи </span> <span class="md-nav__icon md-icon"></span> </a></ul></nav><li class="md-nav__item md-nav__item--pruned md-nav__item--nested"><a class=md-nav__link href=../../../interface/theory/iface/> <span class=md-ellipsis> Interface </span> <span class="md-nav__icon md-icon"></span> </a></ul></nav></ul></nav><li class="md-nav__item md-nav__item--pruned md-nav__item--nested"><a class=md-nav__link href=../../../../../storages/general/types/> <span class=md-ellipsis> Базы данных </span> <span class="md-nav__icon md-icon"></span> </a><li class="md-nav__item md-nav__item--pruned md-nav__item--nested"><a class=md-nav__link href=../../../../../systemDesign/api/api/> <span class=md-ellipsis> Системный дизайн </span> <span class="md-nav__icon md-icon"></span> </a><li class="md-nav__item md-nav__item--pruned md-nav__item--nested"><a class=md-nav__link href=../../../../../screening/hard/> <span class=md-ellipsis> Скрининг </span> <span class="md-nav__icon md-icon"></span> </a></ul></nav></ul></nav></div></div></div><div class="md-sidebar md-sidebar--secondary" data-md-component=sidebar data-md-type=toc><div class=md-sidebar__scrollwrap><div class=md-sidebar__inner><nav class="md-nav md-nav--secondary" aria-label=Содержание><label class=md-nav__title for=__toc><span class="md-nav__icon md-icon"></span> Содержание</label><ul class=md-nav__list data-md-component=toc data-md-scrollfix><li class=md-nav__item><a class=md-nav__link href=#_1> <span class=md-ellipsis> Требования к реализации </span> </a><li class=md-nav__item><a class=md-nav__link href=#_2> <span class=md-ellipsis> Реализация </span> </a> <nav aria-label=Реализация class=md-nav><ul class=md-nav__list><li class=md-nav__item><a class=md-nav__link href=#1> <span class=md-ellipsis> Версия 1 </span> </a><li class=md-nav__item><a class=md-nav__link href=#2> <span class=md-ellipsis> Версия 2 </span> </a></ul></nav><li class=md-nav__item><a class=md-nav__link href=#_3> <span class=md-ellipsis> Рост мапы </span> </a><li class=md-nav__item><a class=md-nav__link href=#_4> <span class=md-ellipsis> Вопросы для самопроверки </span> </a></ul></nav></div></div></div><div class=md-content data-md-component=content><article class="md-content__inner md-typeset"><h1>Теория</h1><h2 id=_1>Требования к реализации<a title="Permanent link" class=headerlink href=#_1>¶</a></h2><ul><li>Вставка<li>Удаление<li>Поиск</ul><p><strong>И все за константное время!</strong><h2 id=_2>Реализация<a title="Permanent link" class=headerlink href=#_2>¶</a></h2><h3 id=1>Версия 1<a title="Permanent link" class=headerlink href=#1>¶</a></h3><div class=highlight><pre><span></span><code><a href=#__codelineno-0-1 id=__codelineno-0-1 name=__codelineno-0-1></a><span class=kd>type</span><span class=w> </span><span class=nx>entry</span><span class=w> </span><span class=kd>struct</span><span class=w> </span><span class=p>{</span>
<a href=#__codelineno-0-2 id=__codelineno-0-2 name=__codelineno-0-2></a><span class=w>    </span><span class=nx>key</span><span class=w> </span><span class=kt>string</span>
<a href=#__codelineno-0-3 id=__codelineno-0-3 name=__codelineno-0-3></a><span class=w>    </span><span class=nx>value</span><span class=w> </span><span class=kt>int</span>
<a href=#__codelineno-0-4 id=__codelineno-0-4 name=__codelineno-0-4></a><span class=p>}</span>
<a href=#__codelineno-0-5 id=__codelineno-0-5 name=__codelineno-0-5></a><span class=kd>type</span><span class=w> </span><span class=nx>simpleMap</span><span class=w> </span><span class=p>[</span><span class=nx>entry</span>
<a href=#__codelineno-0-6 id=__codelineno-0-6 name=__codelineno-0-6></a>
<a href=#__codelineno-0-7 id=__codelineno-0-7 name=__codelineno-0-7></a><span class=kd>func</span><span class=w> </span><span class=nx>lookup</span><span class=p>(</span><span class=nx>m</span><span class=w> </span><span class=nx>simpleMap</span><span class=p>,</span><span class=w> </span><span class=nx>key</span><span class=w> </span><span class=kt>string</span><span class=p>)</span><span class=w> </span><span class=kt>int</span><span class=w> </span><span class=p>{</span>
<a href=#__codelineno-0-8 id=__codelineno-0-8 name=__codelineno-0-8></a><span class=w>    </span><span class=k>for</span><span class=w> </span><span class=o>-</span><span class=w> </span><span class=nx>e</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=k>range</span><span class=w> </span><span class=nx>m</span><span class=w> </span><span class=p>{</span>
<a href=#__codelineno-0-9 id=__codelineno-0-9 name=__codelineno-0-9></a><span class=w>        </span><span class=k>if</span><span class=w> </span><span class=nx>e</span><span class=p>.</span><span class=nx>key</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=nx>key</span><span class=w> </span><span class=p>{</span>
<a href=#__codelineno-0-10 id=__codelineno-0-10 name=__codelineno-0-10></a><span class=w>            </span><span class=k>return</span><span class=w> </span><span class=nx>e</span><span class=p>.</span><span class=nx>value</span>
<a href=#__codelineno-0-11 id=__codelineno-0-11 name=__codelineno-0-11></a><span class=w>        </span><span class=p>}</span>
<a href=#__codelineno-0-12 id=__codelineno-0-12 name=__codelineno-0-12></a><span class=w>    </span><span class=p>}</span>
<a href=#__codelineno-0-13 id=__codelineno-0-13 name=__codelineno-0-13></a>
<a href=#__codelineno-0-14 id=__codelineno-0-14 name=__codelineno-0-14></a><span class=w>    </span><span class=k>return</span><span class=w> </span><span class=mi>0</span>
<a href=#__codelineno-0-15 id=__codelineno-0-15 name=__codelineno-0-15></a><span class=p>}</span>
</code></pre></div><p>Но! Это O(n) поиск. Неудовлетворительно.<h3 id=2>Версия 2<a title="Permanent link" class=headerlink href=#2>¶</a></h3><p>Можем разбить на группы и искать в конкретных группах.<p>Это потребует как-то организовать равномерное распределение ключей по группам. Для этого - нам подходит хеш-функция.<p>К хещ-функции есть следующие требования:<ul><li>Равномерность<li>Быстрота<li>Детерминированность<li>Криптоустойчивость</ul><p>Как это реализовать?<p>Понятно, что v = m[k] - скопилируется в v = runtuime.lookup(m, k).<p>Тогда сигнатура такой функции будет такой: func<k ,v> lookup(m map[k]v, k k) v <p>Но дженерики появились недавно, как разрабы обошлись без них?</p> <ul><li>Все операции выполняются с помощью unsafe.Pointers<li>Мета-инфа хранится в type descriptor<li>type descriptor предоставляет операции hash, eqal, copy</ul> <p>То есть, есть структурка, которая хранит в себе всю необходимую инфу: размер типа и функции, о которых говорили выше:<div class=highlight><pre><span></span><code><a href=#__codelineno-1-1 id=__codelineno-1-1 name=__codelineno-1-1></a><span class=kd>type</span><span class=w> </span><span class=nx>_type</span><span class=w> </span><span class=kd>struct</span><span class=w> </span><span class=p>{</span>
<a href=#__codelineno-1-2 id=__codelineno-1-2 name=__codelineno-1-2></a><span class=w>    </span><span class=nx>size</span><span class=w> </span><span class=kt>uintptr</span>
<a href=#__codelineno-1-3 id=__codelineno-1-3 name=__codelineno-1-3></a><span class=w>    </span><span class=nx>equal</span><span class=w> </span><span class=kd>func</span><span class=w> </span><span class=p>(</span><span class=nx>unsafe</span><span class=p>.</span><span class=nx>Pointer</span><span class=p>,</span><span class=w> </span><span class=nx>unsafe</span><span class=p>.</span><span class=nx>Pointer</span><span class=p>)</span><span class=w> </span><span class=kt>bool</span>
<a href=#__codelineno-1-4 id=__codelineno-1-4 name=__codelineno-1-4></a><span class=w>    </span><span class=o>...</span>
<a href=#__codelineno-1-5 id=__codelineno-1-5 name=__codelineno-1-5></a><span class=p>}</span>
</code></pre></div> В каждой мапе четко определен дескриптор типа и для ключа и для значения: <div class=highlight><pre><span></span><code><a href=#__codelineno-2-1 id=__codelineno-2-1 name=__codelineno-2-1></a><span class=kd>type</span><span class=w> </span><span class=nx>mapType</span><span class=w> </span><span class=kd>struct</span><span class=w> </span><span class=p>{</span>
<a href=#__codelineno-2-2 id=__codelineno-2-2 name=__codelineno-2-2></a><span class=w>    </span><span class=nx>key</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=nx>_type</span>
<a href=#__codelineno-2-3 id=__codelineno-2-3 name=__codelineno-2-3></a><span class=w>    </span><span class=nx>value</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=nx>_type</span>
<a href=#__codelineno-2-4 id=__codelineno-2-4 name=__codelineno-2-4></a><span class=w>    </span><span class=nx>hash</span><span class=w> </span><span class=kd>func</span><span class=w> </span><span class=p>(</span><span class=nx>unsafe</span><span class=p>.</span><span class=nx>Pointer</span><span class=p>,</span><span class=w> </span><span class=kt>uintptr</span><span class=p>)</span><span class=w> </span><span class=kt>uintptr</span>
<a href=#__codelineno-2-5 id=__codelineno-2-5 name=__codelineno-2-5></a><span class=w>    </span><span class=o>...</span><span class=p>.</span>
<a href=#__codelineno-2-6 id=__codelineno-2-6 name=__codelineno-2-6></a><span class=p>}</span>
</code></pre></div> <p>В итоге V = m[k] скомпилируется в:</p> <div class=highlight><pre><span></span><code><a href=#__codelineno-3-1 id=__codelineno-3-1 name=__codelineno-3-1></a><span class=nx>pk</span><span class=o>:=</span><span class=w> </span><span class=nx>Unsafe</span><span class=p>.</span><span class=nx>Pointer</span><span class=p>(</span><span class=o>&</span><span class=nx>k</span><span class=p>)</span>
<a href=#__codelineno-3-2 id=__codelineno-3-2 name=__codelineno-3-2></a><span class=kd>func</span><span class=w> </span><span class=nx>lookup</span><span class=p>(</span><span class=nx>t</span><span class=w> </span><span class=o>*</span><span class=nx>mapType</span><span class=p>,</span><span class=w> </span><span class=nx>m</span><span class=w> </span><span class=o>*</span><span class=nx>mapHeader</span><span class=p>,</span><span class=w> </span><span class=nx>k</span><span class=w> </span><span class=nx>unsafe</span><span class=p>.</span><span class=nx>Pointer</span><span class=p>)</span><span class=w> </span><span class=nx>unsafe</span><span class=p>.</span><span class=w> </span><span class=nx>Pointer</span>
<a href=#__codelineno-3-3 id=__codelineno-3-3 name=__codelineno-3-3></a><span class=nx>pv</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>runtime</span><span class=p>.</span><span class=nx>lookup</span><span class=p>(</span><span class=nx>typeOf</span><span class=p>(</span><span class=nx>m</span><span class=p>),</span><span class=w> </span><span class=nx>m</span><span class=p>,</span><span class=w> </span><span class=nx>pk</span><span class=p>)</span>
<a href=#__codelineno-3-4 id=__codelineno-3-4 name=__codelineno-3-4></a><span class=nx>V</span><span class=w> </span><span class=p>=</span><span class=w> </span><span class=o>*</span><span class=p>(</span><span class=o>*</span><span class=nx>V</span><span class=p>)</span><span class=nx>pv</span>
</code></pre></div> <p>Тут есть новый параметр - mapHeader. Это структура, которая хранит в себе все основную инфу о мапе: - Размер (кол-во элементов в мапе) - Логарифм от кол-ва бакетов (меньше храним и ускоряет побитове операции) - Ссылку на бакеты (массив указателей на бакеты) - Хеш сид (безопасность)</p> <p>Сами бакеты представляют из себя структуру, которая хранит в себе: - Low Order Bits (LOB) - младшие биты хеша - И сами бакеты</p> <p>Небольшое отсупление про LOB: Здесь используется интересное свойство битовой арифметики, а именно - то, что остаток от деления x на y - этo n младших битов числа x, где n - это логарифм y по основанию 2 от y. Тут нам и пригодится хранение логарифма от кол-ва бакетов в виде логарифма от кол-ва бакетов.</p> <p>Сами же бакеты выглядят так: <img alt=img_1.png src=../assets/img_1.png></p> <p>Мы видим 8 слотов для значений, и в каждом бакете есть массив с High Order Bits (HOB) - старшие биты хеша, чтобы проверять по ним есть в этом бакете ключ и пары ключей и значений, которые лежат не по парам, а последовательно для выраванивания типов.</p> <h2 id=_3>Рост мапы<a title="Permanent link" class=headerlink href=#_3>¶</a></h2> <p>Когда мапа заполняется, она растет. Как это происходит?</p> <p>В кажом бакете хранится еще указатель на другой баке, который инициализируется, когда текущий бакет заполняется. <img alt=img_2.png src=../assets/img_2.png></p> <p>Понятное дело, что ждать каждый раз пока мапа полностью заполнится - не самая лучшая идея. Поэтому есть такая штука, как load factor - это примерное кол-во элементов, при котором мапа увеличивается. На текущий момент это 6.5.</p> <p>Вот комментарий от разработчика этой логики:</p> <p>Picking loadFactor: too large and we have lots of overflow buckets, too small and we waste a lot of space. I wrote a simple program to check some stats for different loads: (64-bit, 8 byte keys and elems) loadFactor %overflow bytes/entry hitprobe missprobe 4.00 2.13 20.77 3.00 4.00 4.50 4.05 17.30 3.25 4.50 5.00 6.85 14.77 3.50 5.00 5.50 10.55 12.94 3.75 5.50 6.00 15.27 11.67 4.00 6.00 6.50 20.90 10.79 4.25 6.50 7.00 27.14 10.15 4.50 7.00 7.50 34.03 9.73 4.75 7.50 8.00 41.10 9.40 5.00 8.00</p> <p>%overflow = percentage of buckets which have an overflow bucket bytes/entry = overhead bytes used per key/elem pair hitprobe = # of entries to check when looking up a present key missprobe = # of entries to check when looking up an absent key</p> <p>Этот процесс называется <strong>эвакуацией данных</strong> из бакета. Состоит он в том, что создается новый список данных, который в 2 раза больше, чем предыдущий и данные из старых бакетов переносятся в новые. При этом, если в старом бакете был указатель на другой бакет, то он переносится в новый бакет.</p> <p>Но этот процесс не быстрый и хоть память и выделяется, но сразу не инициализируется, так как это было бы очень дорого. Поэтому, он совершается инкерментально - при вставке и удалении из мапы. <img alt=img_3.png src=../assets/img_3.png></p> <p>Все равно, это дает значительный оверхед, так как приходится смотреть в двух местах. Поэтому - лучше ЗАРАНЕЕ выделять нужное кол-во элементов.</p> <h2 id=_4>Вопросы для самопроверки<a title="Permanent link" class=headerlink href=#_4>¶</a></h2> <ul><li>Почему мы не можем взять указатель на элемент в мапе?<li><p>Все из-за эвакуации бакетов. Если мы возьмем указатель на элемент, а потом добавим новый элемент и мапа расширится, то указатель станет невалидным.</p><li><p>Почему в мапе обход идет в случайном порядке?</p><li><p>Очень много нужно учитывать параметров: какая хеш-функция, какой размер бакета, какой размер мапы, была эвакуация. Поэтому обход идет в случайном порядке.</p><li></ul> <aside class=md-source-file><span class=md-source-file__fact> <span title="Последнее обновление" class=md-icon> <svg viewbox="0 0 24 24" xmlns=http://www.w3.org/2000/svg><path d="M21 13.1c-.1 0-.3.1-.4.2l-1 1 2.1 2.1 1-1c.2-.2.2-.6 0-.8l-1.3-1.3c-.1-.1-.2-.2-.4-.2m-1.9 1.8-6.1 6V23h2.1l6.1-6.1-2.1-2M12.5 7v5.2l4 2.4-1 1L11 13V7h1.5M11 21.9c-5.1-.5-9-4.8-9-9.9C2 6.5 6.5 2 12 2c5.3 0 9.6 4.1 10 9.3-.3-.1-.6-.2-1-.2s-.7.1-1 .2C19.6 7.2 16.2 4 12 4c-4.4 0-8 3.6-8 8 0 4.1 3.1 7.5 7.1 7.9l-.1.2v1.8Z"/></svg> </span> <span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-datetime" title="14 марта 2025 г. 09:17:45">14 марта 2025 г. 09:17:45</span> </span><span class=md-source-file__fact> <span title="Дата создания" class=md-icon> <svg viewbox="0 0 24 24" xmlns=http://www.w3.org/2000/svg><path d="M14.47 15.08 11 13V7h1.5v5.25l3.08 1.83c-.41.28-.79.62-1.11 1m-1.39 4.84c-.36.05-.71.08-1.08.08-4.42 0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8c0 .37-.03.72-.08 1.08.69.1 1.33.32 1.92.64.1-.56.16-1.13.16-1.72 0-5.5-4.5-10-10-10S2 6.5 2 12s4.47 10 10 10c.59 0 1.16-.06 1.72-.16-.32-.59-.54-1.23-.64-1.92M18 15v3h-3v2h3v3h2v-3h3v-2h-3v-3h-2Z"/></svg> </span> <span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-datetime" title="14 марта 2025 г. 09:17:45">14 марта 2025 г. 09:17:45</span> </span></aside> <script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script> <button class="md-top md-icon" data-md-component=top hidden type=button><svg viewbox="0 0 24 24" xmlns=http://www.w3.org/2000/svg><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12Z"/></svg> К началу</button> <footer class=md-footer><div class="md-footer-meta md-typeset"><div class="md-footer-meta__inner md-grid"><div class=md-copyright>Made with <a href=https://squidfunk.github.io/mkdocs-material/ rel=noopener target=_blank> Material for MkDocs </a></div></div></div></footer> <div class=md-dialog data-md-component=dialog><div class="md-dialog__inner md-typeset"></div></div> <script id=__config type=application/json>{"base": "../../../../../..", "features": ["navigation.instant", "navigation.tracking", "navigation.tabs", "navigation.tabs.sticky", "navigation.top", "navigation.indexes", "navigation.prune", "search.suggest", "search.highlight", "search.share", "content.code.copy", "content.tooltips"], "search": "../../../../../../assets/javascripts/workers/search.f886a092.min.js", "translations": {"clipboard.copied": "\u0421\u043a\u043e\u043f\u0438\u0440\u043e\u0432\u0430\u043d\u043e \u0432 \u0431\u0443\u0444\u0435\u0440", "clipboard.copy": "\u041a\u043e\u043f\u0438\u0440\u043e\u0432\u0430\u0442\u044c \u0432 \u0431\u0443\u0444\u0435\u0440", "search.result.more.one": "\u0415\u0449\u0451 1 \u043d\u0430 \u044d\u0442\u043e\u0439 \u0441\u0442\u0440\u0430\u043d\u0438\u0446\u0435", "search.result.more.other": "\u0415\u0449\u0451 # \u043d\u0430 \u044d\u0442\u043e\u0439 \u0441\u0442\u0440\u0430\u043d\u0438\u0446\u0435", "search.result.none": "\u0421\u043e\u0432\u043f\u0430\u0434\u0435\u043d\u0438\u0439 \u043d\u0435 \u043d\u0430\u0439\u0434\u0435\u043d\u043e", "search.result.one": "\u041d\u0430\u0439\u0434\u0435\u043d\u043e 1 \u0441\u043e\u0432\u043f\u0430\u0434\u0435\u043d\u0438\u0435", "search.result.other": "\u041d\u0430\u0439\u0434\u0435\u043d\u043e \u0441\u043e\u0432\u043f\u0430\u0434\u0435\u043d\u0438\u0439: #", "search.result.placeholder": "\u041d\u0430\u0447\u043d\u0438\u0442\u0435 \u043f\u0435\u0447\u0430\u0442\u0430\u0442\u044c \u0434\u043b\u044f \u043f\u043e\u0438\u0441\u043a\u0430", "search.result.term.missing": "\u041e\u0442\u0441\u0443\u0442\u0441\u0442\u0432\u0443\u0435\u0442", "select.version": "\u0412\u044b\u0431\u0435\u0440\u0438\u0442\u0435 \u0432\u0435\u0440\u0441\u0438\u044e"}}</script> <script src=../../../../../../assets/javascripts/bundle.d7c377c4.min.js></script> 